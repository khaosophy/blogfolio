---
import { parse } from 'node-html-parser';
import Excerpt from '../components/Excerpt.astro';
import BlogLayout from '../layouts/BlogLayout.astro';
import Pagination from '../components/Pagination.astro';

const response = await fetch('https://wp.khaosophy.com/wp-json/wp/v2/posts?per_page=100');
const WpPosts = await response.json();
// const totalPages = WpPosts.length / 5;
// WpPosts.splice(5);

const posts = await Astro.glob('../content/blog/*.md');

---
<BlogLayout
	title="All posts"
	description="Casey is a front end developer with a background in SEO and business management."
>
	{/**
	  * Until we convert all content from WordPress to Markdown,
		* we are essentially rendering both data sets.
		* For convenience, we are also removing pagination for now. 
	  */}
	{posts.map(async (post) => {
		/* TODO: add support to overwrite summary/excerpt (here and on the post itself) */
		const { title, slug, date } = post.frontmatter;
		const summary = parse(await post.compiledContent()).querySelector('p:first-of-type');
		return (
			<Excerpt
				id={slug}
				date={date}
				slug={slug}
				title={title}
				summary={summary}
			/>
		);
	})}

	{WpPosts.map(post => (
		<Excerpt
			id={post.id}
			date={post.date}
			slug={post.slug}
			title={post.title.rendered}
			summary={post.excerpt.rendered}
		/>
	))}
	<!-- on the home page, the next page will always be blog page 2 -->
	<!-- <Pagination
		nextPageUrl="/blog/page/2"
		currentPage={1}
		totalPages={totalPages}
	/> -->
</BlogLayout>